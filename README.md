# Askama Minify

ä¸€ä¸ªç”¨äºå‹ç¼© Askama æ¨¡æ¿æ–‡ä»¶çš„ CLI å·¥å…·ã€‚æ”¯æŒå‹ç¼©å•ä¸ªæ–‡ä»¶æˆ–æ‰¹é‡å¤„ç†æ•´ä¸ªæ–‡ä»¶å¤¹ï¼Œæä¾›ä¸“ä¸šçº§çš„ CSS å’Œ JavaScript ä¼˜åŒ–ã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- å‹ç¼© HTMLã€HTMã€XMLã€SVG æ–‡ä»¶
- **å®Œç¾ä¿ç•™** Askama æ¨¡æ¿è¯­æ³•ï¼ˆ`{{ }}` å’Œ `{% %}`ï¼‰
- **ä¸“ä¸šçº§ CSS ä¼˜åŒ–**ï¼šä½¿ç”¨ lightningcss è¿›è¡Œå±æ€§åˆå¹¶ã€é¢œè‰²ä¼˜åŒ–ã€è§„åˆ™ç®€åŒ–
- **æ™ºèƒ½ JavaScript å‹ç¼©**ï¼šè‡ªå®šä¹‰å‹ç¼©å™¨ï¼Œå®‰å…¨å¤„ç†æ‰€æœ‰è¯­æ³•
- **å…¨é¢çš„æ³¨é‡Šç§»é™¤**ï¼š
  - HTML æ³¨é‡Š (`<!-- -->`)
  - CSS æ³¨é‡Š (`/* */`)
  - JavaScript å•è¡Œæ³¨é‡Š (`//`)
  - JavaScript å¤šè¡Œæ³¨é‡Š (`/* */`)
- **æ™ºèƒ½è¾¹ç¼˜æƒ…å†µå¤„ç†**ï¼š
  - ä¿æŠ¤å­—ç¬¦ä¸²ä¸­çš„æ³¨é‡Šè¯­æ³•ï¼ˆå¦‚ `"<!-- not a comment -->"`ï¼‰
  - æ­£ç¡®å¤„ç†é™¤æ³•è¿ç®—ç¬¦ (`/`)
  - æ­£ç¡®å¤„ç†æ¯”è¾ƒå’Œä½è¿ç®—ç¬¦ (`>`, `>>`, `>=`, `<<`)
  - ä¿æŠ¤ URL ä¸­çš„ç‰¹æ®Šå­—ç¬¦
  - ä¿æŠ¤æ­£åˆ™è¡¨è¾¾å¼
- ä¿æŠ¤ç‰¹æ®Šæ ‡ç­¾å†…å®¹ï¼ˆ`<pre>`, `<textarea>`ï¼‰
- æ”¯æŒå•æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹æ‰¹é‡å¤„ç†
- é€’å½’å¤„ç†å­æ–‡ä»¶å¤¹
- è‡ªå®šä¹‰è¾“å‡ºè·¯å¾„å’Œæ–‡ä»¶åç¼€å
- **é«˜å‹ç¼©ç‡**ï¼šé€šå¸¸å¯è¾¾ 40-55%

## å®‰è£…

```bash
cargo build --release
```

ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶ä½äº `target/release/askama-minify`

## æµ‹è¯•

è¿è¡Œå®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼š

```bash
./test.sh
```

æµ‹è¯•è„šæœ¬ä¼šéªŒè¯ï¼š
- é»˜è®¤å‹ç¼©è¡Œä¸º
- è‡ªå®šä¹‰åç¼€
- æŒ‡å®šè¾“å‡ºè·¯å¾„
- æ–‡ä»¶å¤¹æ‰¹é‡å¤„ç†
- é€’å½’å­ç›®å½•å¤„ç†
- å‹ç¼©æ•ˆæœï¼ˆ40-55% å‹ç¼©ç‡ï¼‰
- Askama æ¨¡æ¿è¯­æ³•ä¿ç•™
- CSS å’Œ JavaScript å‹ç¼©åŠŸèƒ½
- HTML/CSS/JS æ³¨é‡Šç§»é™¤
- å­—ç¬¦ä¸²ä¸­æ³¨é‡Šè¯­æ³•ä¿æŠ¤
- è¿ç®—ç¬¦æ­£ç¡®å¤„ç†ï¼ˆ`/`, `>`, `>>`ï¼‰

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

å‹ç¼©å•ä¸ªæ–‡ä»¶ï¼ˆé»˜è®¤ç”Ÿæˆ `.min.html` æ–‡ä»¶ï¼‰ï¼š
```bash
askama-minify template.html
```

å‹ç¼©æ•´ä¸ªæ–‡ä»¶å¤¹ï¼š
```bash
askama-minify templates/
```

### é€‰é¡¹

- `-d, --output <OUTPUT>`: æŒ‡å®šè¾“å‡ºæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹è·¯å¾„ï¼ˆå¦‚æœå·²å­˜åœ¨åˆ™æŠ¥é”™ï¼‰
- `-s, --suffix <SUFFIX>`: è¾“å‡ºæ–‡ä»¶çš„åç¼€åï¼ˆä¸æŒ‡å®šæ—¶ï¼šå¦‚æœè®¾ç½®äº† `-d` åˆ™ä¸æ·»åŠ åç¼€ï¼Œå¦åˆ™é»˜è®¤ä½¿ç”¨ `min`ï¼‰
- `-r, --recursive`: é€’å½’å¤„ç†å­æ–‡ä»¶å¤¹ï¼ˆé»˜è®¤å¯ç”¨ï¼‰
- `-h, --help`: æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
- `-V, --version`: æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯

### åç¼€è§„åˆ™

- **æœªæŒ‡å®š `-d` ä¸”æœªæŒ‡å®š `-s`**: ä½¿ç”¨é»˜è®¤åç¼€ `min`ï¼Œç”Ÿæˆ `file.min.html`
- **æœªæŒ‡å®š `-d` ä½†æŒ‡å®š `-s`**: ä½¿ç”¨æŒ‡å®šåç¼€ï¼Œç”Ÿæˆ `file.<suffix>.html`
- **æŒ‡å®š `-d` ä½†æœªæŒ‡å®š `-s`**: ä¸æ·»åŠ åç¼€ï¼Œç›´æ¥ä½¿ç”¨æŒ‡å®šçš„è¾“å‡ºè·¯å¾„
- **åŒæ—¶æŒ‡å®š `-d` å’Œ `-s`**: åœ¨è¾“å‡ºè·¯å¾„åŸºç¡€ä¸Šæ·»åŠ æŒ‡å®šåç¼€

### ç¤ºä¾‹

**åŸºç¡€å‹ç¼©**ï¼ˆç”Ÿæˆ `template.min.html`ï¼‰ï¼š
```bash
askama-minify template.html
```

**è‡ªå®šä¹‰åç¼€å**ï¼ˆç”Ÿæˆ `template.compressed.html`ï¼‰ï¼š
```bash
askama-minify -s compressed template.html
```

**æŒ‡å®šè¾“å‡ºæ–‡ä»¶**ï¼ˆä¸æ·»åŠ åç¼€ï¼‰ï¼š
```bash
askama-minify -d output.html template.html
```

**æŒ‡å®šè¾“å‡ºæ–‡ä»¶å¤¹**ï¼ˆä¸æ·»åŠ åç¼€ï¼Œä¿æŒç›®å½•ç»“æ„ï¼‰ï¼š
```bash
askama-minify -d output_dir/ templates/
```

**æŒ‡å®šè¾“å‡ºæ–‡ä»¶å¤¹å¹¶æ·»åŠ åç¼€**ï¼š
```bash
askama-minify -d output_dir/ -s prod templates/
```

**è‡ªå®šä¹‰åç¼€å‹ç¼©æ–‡ä»¶å¤¹**ï¼ˆåœ¨åŸç›®å½•ç”Ÿæˆï¼‰ï¼š
```bash
askama-minify -s prod templates/
```

**ä¸é€’å½’å¤„ç†å­æ–‡ä»¶å¤¹**ï¼š
```bash
askama-minify --recursive=false templates/
```

**æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯**ï¼š
```bash
askama-minify --help
```

## æ”¯æŒçš„æ–‡ä»¶ç±»å‹

- `.html`
- `.htm`
- `.xml`
- `.svg`

æ³¨æ„ï¼šè‡ªåŠ¨è·³è¿‡å·²å‹ç¼©çš„æ–‡ä»¶ï¼ˆä¾‹å¦‚ `.min.html`ï¼‰

## å‹ç¼©åŸç†

è¯¥å·¥å…·é‡‡ç”¨å¤šå±‚æ¬¡å‹ç¼©ç­–ç•¥ï¼Œç¡®ä¿æœ€ä½³æ•ˆæœï¼š

### HTML å‹ç¼©
- âœ… **å®Œå…¨ä¿ç•™æ¨¡æ¿è¯­æ³•**ï¼ˆ`{{ }}` å’Œ `{% %}`ï¼‰ï¼Œä¸ä¼šç ´åä»»ä½•æ¨¡æ¿ä»£ç 
- âœ… **ä¿ç•™æ‰€æœ‰å±æ€§å¼•å·**ï¼Œç¡®ä¿å±æ€§å€¼æ­£ç¡®è§£æ
- âœ… **ç§»é™¤å¤šä½™çš„ç©ºç™½å­—ç¬¦**ï¼ˆæ¢è¡Œã€ç¼©è¿›ã€å¤šä½™ç©ºæ ¼ï¼‰
- âœ… **ç§»é™¤ HTML æ³¨é‡Š**ï¼ˆ`<!-- -->`ï¼‰
- âœ… **ä¿æŠ¤ç‰¹æ®Šæ ‡ç­¾**ï¼ˆ`<pre>`, `<textarea>` å†…å®¹å®Œå…¨ä¿ç•™ï¼‰
- âœ… **æ”¯æŒä¸­æ–‡å’Œç‰¹æ®Šå­—ç¬¦**ï¼Œä¸ä¼šç ´åä»»ä½• UTF-8 å†…å®¹

### CSS ä¼˜åŒ–ï¼ˆä½¿ç”¨ lightningcssï¼‰
- âœ… **å±æ€§åˆå¹¶**ï¼š`margin-top: 0; margin-bottom: 0;` â†’ `margin: 0 0`
- âœ… **é¢œè‰²ä¼˜åŒ–**ï¼š`#ff0000` â†’ `red`ï¼Œ`rgb(255,0,0)` â†’ `red`
- âœ… **å€¼ç®€åŒ–**ï¼š`0px` â†’ `0`ï¼Œ`0.5` â†’ `.5`
- âœ… **è§„åˆ™ç®€åŒ–**ï¼šç§»é™¤é‡å¤è§„åˆ™ï¼Œåˆå¹¶ç›¸åŒé€‰æ‹©å™¨
- âœ… **ç§»é™¤ç©ºæ ¼å’Œæ¢è¡Œ**ï¼šç´§å‡‘è¾“å‡ºæ ¼å¼

### JavaScript å‹ç¼©ï¼ˆè‡ªå®šä¹‰å‹ç¼©å™¨ï¼‰
- âœ… **ç§»é™¤æ³¨é‡Š**ï¼šå•è¡Œ (`//`) å’Œå¤šè¡Œ (`/* */`) æ³¨é‡Š
- âœ… **ç§»é™¤ç©ºç™½**ï¼šæ¢è¡Œã€ç¼©è¿›ã€å¤šä½™ç©ºæ ¼
- âœ… **æ™ºèƒ½å­—ç¬¦ä¸²å¤„ç†**ï¼šè¯†åˆ«å•å¼•å·ã€åŒå¼•å·ã€æ¨¡æ¿å­—é¢é‡
- âœ… **ä¿æŠ¤å­—ç¬¦ä¸²å†…å®¹**ï¼šå­—ç¬¦ä¸²ä¸­çš„æ³¨é‡Šè¯­æ³•ä¸ä¼šè¢«ç§»é™¤
- âœ… **è¿ç®—ç¬¦ä¿æŠ¤**ï¼šæ­£ç¡®å¤„ç† `/`, `>`, `>>`, `>=`, `<<` ç­‰
- âœ… **å®‰å…¨å¯é **ï¼šä¸ç ´åä»»ä½•ä»£ç é€»è¾‘

### å‹ç¼©æ•ˆæœ
- é€šå¸¸å‹ç¼©ç‡ï¼š**40-55%**
- CSS ä¼˜åŒ–è´¡çŒ®ï¼š**20-30%**
- JavaScript å‹ç¼©è´¡çŒ®ï¼š**15-25%**
- HTML å‹ç¼©è´¡çŒ®ï¼š**10-15%**
- æ³¨é‡Šç§»é™¤è´¡çŒ®ï¼š**5-10%**ï¼ˆå–å†³äºæ³¨é‡Šå¯†åº¦ï¼‰

ç›¸æ¯”é€šç”¨ HTML å‹ç¼©å™¨çš„ä¼˜åŠ¿ï¼š
- ğŸ”’ **æ›´å®‰å…¨**ï¼šä¸“ä¸ºæ¨¡æ¿æ–‡ä»¶è®¾è®¡ï¼Œå®Œå…¨ä¿ç•™æ¨¡æ¿è¯­æ³•
- ğŸš€ **æ›´é«˜æ•ˆ**ï¼šç»“åˆä¸“ä¸šå·¥å…·ï¼ˆlightningcssï¼‰ï¼Œå®ç°æ›´å¥½çš„å‹ç¼©æ•ˆæœ
- ğŸ¯ **æ›´å¯é **ï¼šä¸é‡æ’å±æ€§ï¼Œä¸ç ´åå¼•å·ï¼Œç¡®ä¿åŠŸèƒ½å®Œæ•´

## ç¤ºä¾‹

### è¾“å…¥æ–‡ä»¶

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>{{ heading }}</h1>
        {% for item in items %}
        <div class="item">
            <h2>{{ item.name }}</h2>
            <p>{{ item.description }}</p>
        </div>
        {% endfor %}
    </div>
    <script>
        console.log("Hello World");
        function greet(name) {
            return "Hello, " + name;
        }
    </script>
</body>
</html>
```

### è¾“å‡ºæ–‡ä»¶

```html
<!doctype html><html lang=zh-CN><meta charset=UTF-8><title>{{ title }}</title><style>body{background-color:#f0f0f0;margin:0;padding:20px;font-family:Arial,sans-serif}.container{max-width:800px;margin:0 auto}</style><body><div class=container><h1>{{ heading }}</h1>{% for item in items %} <div class=item><h2>{{ item.name }}</h2><p>{{ item.description }}</p></div>{% endfor %}</div><script>console.log("Hello World");function greet(name){return"Hello, "+name}</script>
```

**æ³¨æ„**ï¼š
- æ‰€æœ‰æ¨¡æ¿è¯­æ³•ï¼ˆ`{{ title }}`, `{% for %}`ï¼‰å®Œæ•´ä¿ç•™
- CSS å·²ä¼˜åŒ–ï¼ˆå±æ€§åˆå¹¶ã€ç§»é™¤ç©ºæ ¼ï¼‰
- JavaScript å·²å‹ç¼©ï¼ˆç§»é™¤ç©ºæ ¼å’Œæ¢è¡Œï¼‰
- HTML ç»“æ„ä¿æŒå®Œæ•´
- æ‰€æœ‰æ³¨é‡Šå·²ç§»é™¤

## æ³¨é‡Šå¤„ç†ç¤ºä¾‹

### è¾“å…¥ï¼ˆå¸¦æ³¨é‡Šï¼‰

```html
<!DOCTYPE html>
<html>
<head>
    <!-- HTML comment -->
    <style>
        /* CSS comment */
        body { margin: 0; }
    </style>
</head>
<body>
    <script>
        // JS comment
        const str = "<!-- not a comment -->";
        const result = 10 / 2; // division
        if (x > y) { /* comparison */ }
    </script>
</body>
</html>
```

### è¾“å‡ºï¼ˆæ³¨é‡Šå·²ç§»é™¤ï¼Œå­—ç¬¦ä¸²å’Œè¿ç®—ç¬¦ä¿ç•™ï¼‰

```html
<!doctype html><html><head> <style>body{margin:0}</style></head><body><script>const str="<!-- not a comment -->";const result=10/2;if(x>y){}</script></body></html>
```

**å…³é”®ç‰¹æ€§**ï¼š
- âœ… HTML æ³¨é‡Š `<!-- HTML comment -->` å·²ç§»é™¤
- âœ… CSS æ³¨é‡Š `/* CSS comment */` å·²ç§»é™¤
- âœ… JS æ³¨é‡Š `// JS comment` å’Œ `/* comparison */` å·²ç§»é™¤
- âœ… å­—ç¬¦ä¸²ä¸­çš„ `"<!-- not a comment -->"` ä¿ç•™
- âœ… é™¤æ³•è¿ç®—ç¬¦ `10 / 2` ä¿ç•™
- âœ… æ¯”è¾ƒè¿ç®—ç¬¦ `x > y` ä¿ç•™

## æŠ€æœ¯æ ˆ

- **Rust** - æ ¸å¿ƒè¯­è¨€
- **clap** - å‘½ä»¤è¡Œå‚æ•°è§£æ
- **lightningcss** - ä¸“ä¸š CSS è§£æå’Œä¼˜åŒ–
- **è‡ªå®šä¹‰ JS å‹ç¼©å™¨** - å®‰å…¨å¯é çš„ JavaScript å‹ç¼©
- **walkdir** - æ–‡ä»¶éå†

## æ›´æ–°æ—¥å¿—

### v0.1.0 (å½“å‰ç‰ˆæœ¬)
- âœ… å®Œæ•´çš„ HTML/CSS/JS å‹ç¼©æ”¯æŒ
- âœ… å®Œç¾ä¿ç•™ Askama æ¨¡æ¿è¯­æ³•
- âœ… æ™ºèƒ½æ³¨é‡Šç§»é™¤ï¼ˆHTMLã€CSSã€JSï¼‰
- âœ… è¾¹ç¼˜æƒ…å†µä¿æŠ¤ï¼ˆå­—ç¬¦ä¸²ã€è¿ç®—ç¬¦ã€æ­£åˆ™è¡¨è¾¾å¼ï¼‰
- âœ… è‡ªå®šä¹‰ JavaScript å‹ç¼©å™¨ï¼ˆæ›¿ä»£æœ‰ bug çš„ç¬¬ä¸‰æ–¹åº“ï¼‰
- âœ… å‹ç¼©ç‡ï¼š40-55%
- âœ… 10 ä¸ªæµ‹è¯•åœºæ™¯å…¨éƒ¨é€šè¿‡

## è®¸å¯è¯

MIT
